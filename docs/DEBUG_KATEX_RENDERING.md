# Debug: KaTeX Rendering Issue

## Issue Description
Formulas in `tests/fixtures/test-sample.md` are rendering incorrectly. Characters are overlapping and positioning is off, as seen in the provided screenshot. The quadratic formula block is severely garbled.

## Investigation Log
### 1. Initial Analysis
- `web-renderer/package.json` includes `katex` and `markdown-it-katex`.
- `web-renderer/src/index.ts` imports `'katex/dist/katex.min.css'`.
- Webpack config was updated to handle fonts inline (`asset/inline`), which solved missing font files issue, but the rendering is still broken.

### 2. Reference Project Comparison
- `markdown-preview-enhanced` (MPE) works correctly (reference project).
- MPE uses `@shd101wyy/mume` which handles rendering.
- `markdown-quicklook` uses `markdown-it-katex` version `^2.0.3` (which is quite old) with a forced override to `katex` `^0.16.27`.

### 3. Hypothesis: Plugin Incompatibility
- `markdown-it-katex` v2.0.3 was designed for much older versions of KateX (v0.6.0).
- While we forced it to use KateX v0.16.27 via `package.json` overrides, the HTML structure generated by the old plugin might not be fully compatible with the CSS/JS of the new KateX version.
- MPE likely uses a more modern integration or handles it internally in `mume`.

## Resolution Plan
1.  **Replace Plugin**: Switch from `markdown-it-katex` to `@iktakahiro/markdown-it-katex`. This fork is actively maintained and designed to work with newer versions of KateX.
2.  **Update Dependencies**:
    - Remove `markdown-it-katex`.
    - Add `@iktakahiro/markdown-it-katex`.
    - Ensure `katex` dependency matches.
3.  **Update Code**: Update `web-renderer/src/index.ts` to use the new plugin.
4.  **Verify**: Rebuild and check rendering.

## Resolution Status
- **Fix Applied**:
    1. Replaced `markdown-it-katex` with `@iktakahiro/markdown-it-katex` in `web-renderer`.
    2. Removed `package.json` overrides for `katex`.
    3. Updated `src/index.ts` to use the new plugin.
    4. Rebuilt `markdown-quicklook`.
- **Verification**: User verified that the math rendering issue is resolved.

## Additional Checks
- **Mermaid**: Configuration verified. Uses `mermaid.run` which is correct for v10+. Rendering confirmed via logs.
- **Highlight.js**: Configuration verified. Uses `hljs.highlight(str, { language: ... })` which is correct for v11+.
- **Task Lists**: Using `markdown-it-task-lists` v2.1.1. No known issues with current setup.
